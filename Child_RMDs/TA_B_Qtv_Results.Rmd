---
title: "Exhibit Results"
output: html_document
date: "2022-10-11"
---

```{r echo=FALSE}
# \blandscape
# <!---BLOCK_LANDSCAPE_START--->
```

## Data processing and quality assurance
The raw dataset, that included records for each time any participant began viewing the online survey had `r preprocessing_log_ls$raw_case_nbrs_1L_int` records.

```{r include=F}
preprocessing_log_ls$raw_case_nbrs_1L_int
```

When we dropped all records for which there were zero responses to the choice card questions, the number of records was `r preprocessing_log_ls$raw_choice_resps_1L_int`.

```{r include=F}
preprocessing_log_ls$raw_choice_resps_1L_int
```

A total of `r flags_tb %>% dplyr::filter(Outcome == "red_flag_count_int") %>% dplyr::pull(n) %>% make_number_text(capitalize_1L_lgl=T, threshold_1L_int = 100)` red flags were assigned to `r preprocessing_log_ls$flags_freq_df %>% dplyr::filter(Var1 != "0") %>% dplyr::pull(Freq) %>% sum()` cases as a result of data integrity checks. 

```{r echo=FALSE}
preprocessing_log_ls$flags_freq_df %>% dplyr::rename(`Number of Red Flags` = Var1,
                                                     Frequency = Freq) %>%
  kableExtra::kbl(booktabs = T, longtable = T, caption = "Frequency of red flags from data integrity checks") 
```

```{r echo=FALSE}
flags_tb <- make_tfd_flags_smry_tb(preprocessing_log_ls,
                                   records_ls = records_ls,
                                   country_1L_chr = "Australia")
```

`r flags_tb %>% dplyr::filter(Outcome == "red_flag_qltv_ax_lgl") %>% dplyr::pull(n) %>% make_number_text(capitalize_1L_lgl=T, threshold_1L_int = 100)` of these red flags were added from the qualitative assessment of participant free text responses, with the balance being flags generated by automated checks of country of origin, inconsistencies between age and date of birth data, email addresses with five or greater consecutive numeric digits, duplicate free text entries across cases and survey completion times of under five minutes.

```{r echo=FALSE, tab.cap = "Types of red flags"}
make_tfd_flags_smry_tb(preprocessing_log_ls,
                                   records_ls = records_ls,
                                   country_1L_chr = "Australia",
                                   what_1L_chr = "red") %>% 
  kableExtra::kbl(booktabs = T, longtable = T, caption = knitr::opts_current$get("tab.cap")) 
```
In `r flags_tb %>% dplyr::filter(Outcome =="exluded_by_alg_lgl")  %>% dplyr::pull(n) %>% make_number_text()` cases the red flags generated by automated assessments were not in conflict with qualitative assessment (ie the qualitative assessment either also assigned a red flag or did not assign a green flag) and were dropped from our dataset. Also removed from our dataset were `r flags_tb %>% dplyr::filter(Outcome =="qltv_force_out_lgl")  %>% dplyr::pull(n) %>% make_number_text()` records that were red flagged by the qualitative assessment but which had no automatically generated red flags. In `r flags_tb %>% dplyr::filter(Outcome =="qltv_force_in_lgl")  %>% dplyr::pull(n) %>% make_number_text()` cases, red-flags added by the automated assessment were in conflict with green flags added by the qualitative assessment - these records were retained. In total, the qualitative assessment assigned a total of `r flags_tb %>% dplyr::filter(Outcome =="green_flag_qltv_ax_lgl")  %>% dplyr::pull(n) %>% make_number_text()` green flags to confirm records for inclusion.

```{r echo=FALSE, tab.cap = "Qualitative and automated assessment summary"}
make_tfd_flags_smry_tb(preprocessing_log_ls,
                       records_ls = records_ls,
                       country_1L_chr = "Australia",
                       what_1L_chr = "outcome") %>%
  kableExtra::kbl(booktabs = T, longtable = T, caption = knitr::opts_current$get("tab.cap")) 
```

After dropping records arising from the data integrity checks, `r preprocessing_log_ls$raw_unflagged_1L_int` records remained.

```{r include=FALSE}
preprocessing_log_ls$raw_unflagged_1L_int
```


When these records were combined with the choice cards dataset and that merged dataset reshaped to long format (each case being a unique combination of the `r dce_design_ls$choice_sets_ls$alternatives_chr %>% length()` alternatives for each of `r dce_design_ls$choice_sets_ls$nbr_of_sets_1L_int/dce_design_ls$choice_sets_ls$nbr_of_blocks_1L_int` choice situations presented to each individual participant) the number of records expanded to `r preprocessing_log_ls$cases_wide_1L_int`.

```{r include=FALSE}
preprocessing_log_ls$cases_wide_1L_int
```

`r officer::run_pagebreak()`
\newpage

## Sample characteristics and choice responses

### Representativeness of sample

```{r echo=FALSE, tab.cap = "Sample age proportions compared to official population estimates"}
descriptives_ls$prpn_cmprsns_ls$age_cmprsn_tb %>%
  print_cmprsn_kbl(caption_1L_chr = knitr::opts_current$get("tab.cap"))
```
```{r echo=F, tab.cap = "Sample resident jurisdictions proportions compared to age and sex based official population estimates"}
descriptives_ls$prpn_cmprsns_ls$area_cmprsn_tb %>%
   print_cmprsn_kbl(caption_1L_chr = knitr::opts_current$get("tab.cap"))
```

`r officer::run_pagebreak()`
\newpage

```{r echo = F, tab.cap = "Sample area disadvantage proportions compared to expected proportions"}
descriptives_ls$prpn_cmprsns_ls$SEIFA_cmprsn_tb %>%
     print_cmprsn_kbl(caption_1L_chr = knitr::opts_current$get("tab.cap"))
```
```{r echo = F, tab.cap = "Sample urbanicity proportions compared to age and sex based official population estimates"}
descriptives_ls$prpn_cmprsns_ls$urban_cmprsn_tb %>%
     print_cmprsn_kbl(caption_1L_chr = knitr::opts_current$get("tab.cap"))
```

`r officer::run_pagebreak()`
\newpage
### Choice responses

```{r, echo=FALSE, results='asis'}
make_choice_descvs_params(dce_design_ls,
                          records_ls = records_ls,
                          opt_out_nm_1L_chr = "Opt out") %>%
  purrr::walk(~knit_choice_decvs_rprt(.x,
                                   path_to_mdl_rprt_tmpl_1L_chr = "../Child_RMDS/TA_Qtv_Choice_Descvs.Rmd"))
```

\newpage

## Choice models

### Models of how social anxiety app attributes shape the choice behaviour of young people

```{r echo=FALSE, tab.cap='Multinomial Logit Model (estimated with mlogit package)'}
mdls_ls$mnl_mlogit_mdl %>%
  print_tfd_mdl_smry(caption_1L_chr = knitr::opts_current$get("tab.cap"),
                     dce_design_ls = dce_design_ls,
                     records_ls = records_ls,
                     digits_1L_int = params$X@digits_int,
                     opt_out_nm_1L_chr = "Opt out")
```
```{r echo=FALSE}
make_mdl_smry(mdls_ls$mnl_mlogit_mdl, return_1L_chr = "performance") %>%
  kableExtra::kbl(booktabs = T, longtable = T, caption = "Performance of Multinomial Logit Model (estimated with mlogit package)")
```

\newpage

### Models of the heterogeneity of young people's preferences for social anxiety apps

```{r echo=FALSE, tab.cap='Mixed Logit Model (estimated with gmnl package)'}
mdls_ls$mixl_mdl %>%
  print_tfd_mdl_smry(caption_1L_chr = knitr::opts_current$get("tab.cap"),
                     confidence_intvl_int = 6:7,
                     dce_design_ls = dce_design_ls,
                     records_ls = records_ls,
                     digits_1L_int = params$X@digits_int,
                     opt_out_nm_1L_chr = "Opt out")
```
```{r echo=FALSE}
make_mdl_smry(mdls_ls$mixl_mdl, return_1L_chr = "performance") %>% 
  kableExtra::kbl(booktabs = T, longtable = T, 
                  caption = "Performance of Mixed Logit Model (estimated with gmnl package)")
```

\newpage

```{r echo=FALSE, tab.cap='Mixed Logit Model (estimated with mlogit package)'}
mdls_ls$mixl_mlogit_mdl %>%
  print_tfd_mdl_smry(caption_1L_chr = knitr::opts_current$get("tab.cap"),
                     dce_design_ls = dce_design_ls,
                     records_ls = records_ls,
                     digits_1L_int = params$X@digits_int,
                     opt_out_nm_1L_chr = "Opt out")
```
```{r echo=FALSE}
make_mdl_smry(mdls_ls$mixl_mlogit_mdl, return_1L_chr = "performance") %>% 
  kableExtra::kbl(booktabs = T, longtable = T, 
                  caption = "Performance of Mixed Logit Model (estimated with mlogit package)")
```

\newpage

```{r echo=FALSE, tab.cap = 'Generalised Multinomial Logit Model (estimated with gmnl package)'}
mdls_ls$gmnl_mdl %>%
  print_tfd_mdl_smry(caption_1L_chr = knitr::opts_current$get("tab.cap"),
                     confidence_intvl_int = 6:7,
                     dce_design_ls = dce_design_ls,
                     records_ls = records_ls,
                     digits_1L_int = params$X@digits_int,
                     opt_out_nm_1L_chr = "Opt out")
```
```{r echo=FALSE}
make_mdl_smry(mdls_ls$gmnl_mdl, return_1L_chr = "performance") %>% 
  kableExtra::kbl(booktabs = T, longtable = T, 
                  caption = "Performance of Generalised Multinomial Logit Model (estimated with gmnl package)")
```

\newpage


### Models of social anxiety app preference based sub-groups of young people

```{r echo=FALSE, tab.cap='Basic latent class model (estimated with gmnl package)'}
if(!exists("lc_smry_tb")){
  lc_smry_tb <- make_mdl_smry(mdls_ls$lc_mdl) %>%
    transform_mdl_smry(dce_design_ls = dce_design_ls,
                       records_ls = records_ls,
                       confidence_intvl_int = 6:7,
                       digits_1L_int = params$X@digits_int) 
}
lc_smry_tb %>%
  dplyr::select(Concept, dplyr::everything()) %>%
  dplyr::mutate(Concept = Concept %>% stringr::str_replace_all(records_ls$opt_out_var_nm_1L_chr, "Opt out") %>%
                  stringr::str_replace_all("_"," ")) %>%
  kableExtra::kbl(booktabs = T, longtable = T,
                  caption = knitr::opts_current$get("tab.cap")) %>%
  kableExtra::collapse_rows(1:3, row_group_label_position = 'stack') %>%
  kableExtra::footnote(general = "Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘n.s. ’ 1")
```
```{r echo=FALSE}
make_mdl_smry(mdls_ls$lc_mdl, return_1L_chr = "performance") %>% 
  kableExtra::kbl(booktabs = T, longtable = T, 
                  caption = "Performance of basic Latent Class Model (estimated with gmnl package)") 
```

`r officer::run_pagebreak()`
\newpage

```{r echo=FALSE, tab.cap='Mixed latent class model (estimated with gmnl package)'}
make_mdl_smry(mdls_ls$lc_mxd_mdl)  %>%
  transform_mdl_smry(dce_design_ls = dce_design_ls,
                     mdl_params_ls = mdl_params_ls,
                     records_ls = records_ls,
                     confidence_intvl_int = 6:7,
                     digits_1L_int = params$X@digits_int) %>%
  dplyr::select(Concept, dplyr::everything()) %>%
  dplyr::mutate(Concept = Concept %>% stringr::str_replace_all(records_ls$opt_out_var_nm_1L_chr, "Opt out") %>%
                  stringr::str_replace_all("_"," ")) %>%
  kableExtra::kbl(booktabs = T, longtable = T,
                  caption = knitr::opts_current$get("tab.cap")) %>%
  kableExtra::collapse_rows(1:3, row_group_label_position = 'stack') %>%
     kableExtra::footnote(general = c("Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘n.s. ’ 1",
                                      "Call: ",
                                      mdls_ls$lc_mxd_mdl$call %>% print() %>% capture.output()  %>% trimws()))
```

`r officer::run_pagebreak()`
\newpage

```{r echo=FALSE}
make_mdl_smry(mdls_ls$lc_mxd_mdl, return_1L_chr = "performance") %>% 
  kableExtra::kbl(booktabs = T, longtable = T, 
                  caption = "Performance of Mixed Latent Class model (estimated with gmnl package)")  
```

`r officer::run_pagebreak()`
\newpage

```{r echo=FALSE, warning=FALSE, message=FALSE, eval=FALSE}
make_mdl_smry(mdls_ls$mm_cor_mdl) %>%
  dplyr::mutate(Parameter = Parameter %>% purrr::map_chr(~stringr::str_replace_all(.x,"Outcomes","Outc") %>%
                                                           stringr::str_replace_all("Information_sharing","Info_sh") %>%
                                                           stringr::str_replace_all("Social","Soc") %>%
                                                           stringr::str_replace_all("Endorsers","End"))) %>%
  kableExtra::kbl(booktabs = T, longtable = T, 
                  caption = "Mixed Mixed Model with correlated random parameters (estimated with gmnl package)") %>%
    kableExtra::footnote(general = "Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1")
```
```{r echo=FALSE, warning=FALSE, message=FALSE, eval=FALSE}
make_mdl_smry(mdls_ls$mm_cor_mdl, return_1L_chr = "performance") %>% 
  kableExtra::kbl(booktabs = T, longtable = T, 
                  caption = "Performance of Mixed Mixed Model with correlated random parameters (estimated with gmnl package)")
```

```{r echo=FALSE, eval=FALSE}
# The yet to be addressed issue with the NAs can also be seen when looking at the standard deviations of the random parameters.
vcov(mdls_ls$mm_cor_mdl,what = "ranp", Q=1, type = "sd", se = T)
vcov(mdls_ls$mm_cor_mdl,what = "ranp", Q=2, type = "sd", se = T)
## Note: unable to assign vcov output to object
```

`r officer::run_pagebreak()`
\newpage

\blandscape
<!---BLOCK_LANDSCAPE_START--->
 
### Models of the relationship between young people's characteristics and their preferences for social anxiety apps

```{r echo=FALSE, tab.cap = "Signficiant participant characteristic predictors of each attribute from attribute specific mixed models (all estimated with gmnl package)"}
mdls_ls$att_predn_mdls_ls %>% make_signft_concepts_tbl(mdl_params_ls) %>% 
  dplyr::select(-c(predicts_ls,predictors_ls, total_int)) %>%
  t() %>%
  as.data.frame() %>%
  tibble::rownames_to_column() %>%
  janitor::row_to_names(1) %>%
  tibble::as_tibble()  %>%
  dplyr::rename(Attribute = concept_chr,
                #### NEED TO GENERALISE
                Jurisdiction = jurisdiction,
                `Area disadvantage` = `area disadvantage`,
                `Entourage` = `pilot participant`,
                Gender = gender,
                `Survey response time` = `time taken`,
                Urban = urbanicity
                ####
                ) %>%
  dplyr::mutate(Attribute = Attribute %>% stringr::str_remove_all("_predrs_chr") %>% stringr::str_replace_all("opt_out", "Opt out") %>% stringr::str_replace_all("_", " "),
                #### NEED TO GENERALISE
                Jurisdiction = Jurisdiction %>% stringr::str_remove_all("der_STE_"),
                `Area disadvantage` = `Area disadvantage` %>% stringr::str_remove_all("der_SEIFA_")
                ####
                ) %>%
  dplyr::mutate(dplyr::across(dplyr::everything(), ~ .x %>% purrr::map_chr(~ ifelse(is.na(.x),
                                                                                    "",
                                                                                    ifelse(.x %in% mdl_params_ls$candidate_predrs_tb$short_name_chr,
                                                                                           ready4::get_from_lup_obj(mdl_params_ls$candidate_predrs_tb,
                                                                                                                    match_value_xx = .x,
                                                                                                                    match_var_nm_1L_chr = "short_name_chr",
                                                                                                                    target_var_nm_1L_chr = "long_name_chr"),
                                                                                           .x) %>%
                                                                                      #### NEED TO GENERALISE 
                                                                                      stringr::str_replace("Entourage pilot programme participant", "Pilot participant") %>%
                                                                                      stringr::str_replace("completed survey in under ten minutes", "Under ten minutes") %>%
                                                                                      stringr::str_replace("resides in an urban area", "Yes") %>%
                                                                                      stringr::str_replace("other gender or prefer not to say", "Other or PNTS")
                                                                                    ####
                                                                                    )))) %>%
  kableExtra::kbl(booktabs = T, longtable = T, 
                  caption = knitr::opts_current$get("tab.cap"))
```

\elandscape
<!---BLOCK_LANDSCAPE_STOP--->

```{r echo=F, tab.cap = "Performance of models with participant characteristic predictors (all estimated with gmnl package)"}
make_indl_mdl_smry_tb(mdls_ls) %>%
  kableExtra::kbl(booktabs = T, longtable = T, 
                  caption = knitr::opts_current$get("tab.cap"))
```

```{r, echo=FALSE, results='asis'}
make_indl_mdls_knit_params(mdls_ls) %>%
  purrr::walk(~knit_indl_mdls_rprt(.x,
                                   path_to_mdl_rprt_tmpl_1L_chr = "../Child_RMDS/TA_Qtv_Indl_Mdls.Rmd"))
```

`r officer::run_pagebreak()`
\newpage

## Application of choice models

### Generating Willingness To Pay Estimates

#### Willingness To Pay Estimates from WTP Space
We can calculate Willingness to Pay Values from Willingness To Pay space using the Scaled Multinomial Logit Model.

```{r echo= F, tab.cap='Willingness to pay estimated from willingness to pay space using a scaled multinomial logit model (estimated with gmnl package)'}
analysis_ls$wtp_smnl_smry_ls$CoefTable %>%  as.data.frame() %>% tibble::rownames_to_column("Parameter") %>% 
      tibble::as_tibble() %>% dplyr::mutate(sign = cut(!!rlang::sym("Pr(>|z|)"), breaks = c(-Inf, 0.001, 0.01, 0.05, 0.1,Inf), 
                                                       labels = c("***", "**", "*", ".","n.s."), right = FALSE))  %>%
  transform_mdl_smry(dce_design_ls = dce_design_ls, 
                     records_ls = records_ls,
                     digits_1L_int = params$X@digits_int,
                     opt_out_nm_1L_chr = "Opt out")  %>%
  print_mdl_smry_kbl(records_ls = records_ls,
                     caption_1L_chr = knitr::opts_current$get("tab.cap"))
```

`r officer::run_pagebreak()`
\newpage

#### Willingness To Pay Heterogeneity
We can also explore how WTP values vary across individuals.

```{r echo=FALSE, tab.cap='"Willingness to pay estimated from generalised multinomial logit model with correlated random parameters (estimated with gmnl package)'}
make_mdl_smry(mdls_ls$gmnl_wtp_cor_mdl) %>%
  transform_mdl_smry(dce_design_ls = dce_design_ls, 
                     records_ls = records_ls,
                     confidence_intvl_int = 6:7,
                     digits_1L_int = params$X@digits_int,
                     opt_out_nm_1L_chr = "Opt out")  %>%
  print_mdl_smry_kbl(records_ls = records_ls,
                     caption_1L_chr = knitr::opts_current$get("tab.cap"))
```
`r officer::run_pagebreak()`
\newpage

### Predicting Market Share

#### Market share predictions using the same choice situations as that used in the original survey

```{r echo=FALSE}
tibble::tibble(Alternative = names(analysis_ls$prpns_mnl_prdn_dbl),
               `MNL model (gmnl package)` = analysis_ls$prpns_mnl_prdn_dbl,
               `MNL model, (mlogit package)` = analysis_ls$prpns_mnl_mlogit_prdn_dbl,
               Observed = analysis_ls$prpns_obsd_dbl) %>%
    dplyr::mutate(dplyr::across(where(is.numeric), ~round(.x *100, digits = params$X@digits_int))) %>%
  kableExtra::kbl(booktabs = T, longtable = T, 
                  caption = "Market share predictions from multinomial logit models compared to observed sample proportions") %>%
  kableExtra::kable_styling() %>%
  kableExtra::add_header_above(c(" " = 1, "Predicted share (%)" = 2, " " = 1))
```

```{r echo=FALSE}
analysis_ls$prpns_mixl_prdn_tb %>%
  dplyr::mutate(dplyr::across(where(is.numeric), ~round(.x *100, digits = params$X@digits_int))) %>%
  kableExtra::kbl(booktabs = T, longtable = T, 
                  caption = "Market share predictions from mixed logit models (estimated with gmnl package)") 
```
```{r echo=FALSE}
analysis_ls$prpns_mixl_mlogit_prdn_tb %>%
  dplyr::mutate(dplyr::across(where(is.numeric), ~round(.x *100, digits = params$X@digits_int))) %>%
  kableExtra::kbl(booktabs = T, longtable = T, 
                  caption = "Market share predictions from mixed logit models (estimated with mlogit package)") 
```

#### Market share predictions using new choice situations
We created a hypothetical choice between a reference app, a competing app and an opt out option where:

 - the reference app had a $25 cost, was endorsed by experts, had both peer and clinician moderators, provided knowledge and skills to manage future situations and shared no information with app users' treating clinicians; and
 
 - the competing app had a $0 cost, had no endorsers, had no discussions with other app users, provided knowledge and skills to manage future situations and shared no information with app users' treating clinicians.

The market share predictions from both a multinomial model and mixed logit model for each app under this choice situation is summarised in Table \@ref(tab:hypchoice1)).

`r officer::run_pagebreak()`
\newpage

```{r hypchoice1, echo=FALSE,  tab.id = 'hypchoice1', tab.cap = "Market share predictions from multinomial and mixed logit models (both estimated with mlogit package) of hypotetical choice situation one"}
analysis_ls$new_data_ls$comparison_1_ls$predd_share_tb %>%
  dplyr::rename(`Multinomial Model` = mnl_mlogit_mdl_prediction,
                `Mixed Logit Model` = mixl_mlogit_mdl_prediction) %>%
  dplyr::mutate(dplyr::across(where(is.numeric), ~round(.x *100, digits = params$X@digits_int))) %>%
  dplyr::mutate(Alternative = Alternative %>% stringr::str_replace_all("Entourage", "Reference App")) %>%
  kableExtra::kbl(booktabs = T, longtable = T, 
                  caption = knitr::opts_current$get("tab.cap")) %>%
  kableExtra::kable_styling() %>%
  kableExtra::add_header_above(c(" " = 1, "Predicted share (%)" = 2))
```

We then changed the configuration of the reference app by adding a user controlled setting for app information sharing. The market share predictions under this modified scenario are summarised in Table \@ref(tab:hypchoice2).

```{r hypchoice2, echo=FALSE,  tab.id = 'hypchoice2', tab.cap = "Market share predictions from multinomial and mixed logit models (both estimated with mlogit package) of hypotetical choice situation two"}
analysis_ls$new_data_ls$comparison_2_ls$predd_share_tb %>%
    dplyr::rename(`Multinomial Model` = mnl_mlogit_mdl_prediction,
                `Mixed Logit Model` = mixl_mlogit_mdl_prediction) %>%
  dplyr::mutate(dplyr::across(where(is.numeric), ~round(.x *100, digits = params$X@digits_int))) %>%
  dplyr::mutate(Alternative = Alternative %>% stringr::str_replace_all("Entourage", "Reference App")) %>%
  kableExtra::kbl(booktabs = T, longtable = T, 
                  caption = knitr::opts_current$get("tab.cap")) %>%
  kableExtra::kable_styling() %>%
  kableExtra::add_header_above(c(" " = 1, "Predicted share (%)" = 2))
```

`r officer::run_pagebreak()`
\newpage

We reran the first hypothetical choice situation adjusting the price between \$25 and \$50.

```{r echo=FALSE}
analysis_ls$new_data_ls$cost_comparison_ls$predd_shares_ls$mnl_mlogit_mdl_predd_tb %>% dplyr::filter(Cost %in% seq(0,50,by=5)) %>%
      dplyr::rename(`Reference App` = Entourage) %>%
  dplyr::mutate(dplyr::across(c(`Reference App`,`Competing App`,`No App`), ~round(.x *100, digits = params$X@digits_int))) %>%
  kableExtra::kbl(booktabs = T, longtable = T, 
                  caption = "Market share predictions from multimomial logit models (estimated with mlogit package) of hypotetical choice situation three") %>%
  kableExtra::kable_styling() %>%
  kableExtra::add_header_above(c(" " = 1, "Predicted share (%)" = 3))
```
```{r echo=FALSE}
analysis_ls$new_data_ls$cost_comparison_ls$predd_shares_ls$mixl_mlogit_mdl_predd_tb %>% dplyr::filter(Cost %in% seq(0,50,by=5)) %>%
  dplyr::rename(`Reference App` = Entourage) %>%
  dplyr::mutate(dplyr::across(c(`Reference App`,`Competing App`,`No App`), ~round(.x *100, digits = params$X@digits_int))) %>%
  kableExtra::kbl(booktabs = T, longtable = T, 
                  caption = "Market share predictions from mixed logit models (estimated with mlogit package) of hypotetical choice situation three") %>%
  kableExtra::kable_styling() %>%
  kableExtra::add_header_above(c(" " = 1, "Predicted share (%)" = 3))
```
